<div
  *ngIf="
    this.currentSession && this.creator && this.currentUser && this.participants
  "
>
  <div class="container">
    <div class="row">
      <div class="col">
        <h2 *ngIf="!this.editingSession">{{ this.currentSession.title }}</h2>
        <input
          [(ngModel)]="currentSession.title"
          *ngIf="this.editingSession"
          class="titleEdit"
          type="text"
        />
        <p>
          Session's creator is
          <i
            ><b>{{ creator.firstName }} {{ creator.lastName }}</b></i
          >
        </p>
      </div>
      <div *ngIf="shouldShowActions()" class="col" align="right">
        <button
          *ngIf="this.editingSession"
          (click)="deleteSession()"
          style="margin: 5px"
          type="button"
          class="btn btn-danger"
        >
          Delete
        </button>
        <button
          *ngIf="!editingSession"
          (click)="edit()"
          type="button"
          class="btn btn-primary"
        >
          Edit Session
        </button>
        <button
          *ngIf="editingSession"
          (click)="stopEditing()"
          type="button"
          class="btn btn-success"
          [disabled]="this.invalidSession"
        >
          Done editing
        </button>
      </div>
    </div>
    <div class="row">
      <div *ngIf="!this.editingSession" class="col">
        <em>Session</em> is active from:
        <i>{{ parseDate(this.currentSession.startDate) }}</i> -
        <i>{{ parseDate(this.currentSession.endDate) }}</i>
      </div>
      <div *ngIf="this.editingSession" class="col">
        <div class="startDate">
          <label style="margin-right: 5px"> Start date:</label>
          <input
            class="form-control"
            style="width: 15%; display: inline"
            matInput
            [matDatepicker]="startPicker"
            [(ngModel)]="this.currentSession.startDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="startPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
          <em *ngIf="this.startDateErrors()" style="color: red">
            {{ this.startDateErrors() }}
          </em>
        </div>
        <div class="endDate">
          <label style="margin-right: 12px">End date:</label>
          <input
            class="form-control"
            style="width: 15%; display: inline"
            matInput
            [matDatepicker]="endPicker"
            [(ngModel)]="this.currentSession.endDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="endPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
          <em *ngIf="this.endDateErrors()" style="color: red">
            {{ this.endDateErrors() }}
          </em>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <p>
          <em>Session's</em> status:
          <span
            [ngClass]="{
              active: getStatus() === 'Active',
              upcoming: getStatus() === 'Upcoming',
              closed: getStatus() === 'Finished'
            }"
            >{{ getStatus() }}</span
          >
        </p>
      </div>
    </div>
    <div class="row">
      <div *ngIf="!this.editingSession" class="col">
        <em>Form</em> is active from:
        <i>{{ parseDate(this.currentForm.startDate) }}</i> -
        <i>{{ parseDate(this.currentForm.endDate) }}</i>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <p>
          <em>Form's</em> status:
          <span
            [ngClass]="{
              active: getCurrentFormStatus() === 'Active',
              upcoming: getCurrentFormStatus() === 'NotStarted',
              closed: getCurrentFormStatus() === 'Ended'
            }"
            >{{ getCurrentFormStatus() }}</span
          >
        </p>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row" style="border-bottom: 1px solid rgba(128, 128, 128, 0.35)">
      <div
        class="col"
        style="padding: 0; border-left: 1px solid rgba(128, 128, 128, 0.155)"
        align="center"
      >
        <button
          class="sessionTypeButton"
          [ngClass]="{ selected: this.whatToDisplay == 'candidates' }"
          (click)="this.changeDisplay('candidates')"
        >
          Candidates
        </button>
      </div>
      <div class="col" style="padding: 0" align="center">
        <button
          class="sessionTypeButton"
          [ngClass]="{ selected: this.whatToDisplay == 'form' }"
          (click)="this.changeDisplay('form')"
        >
          Form
        </button>
      </div>
      <div
        class="col"
        style="padding: 0; border-left: 1px solid rgba(128, 128, 128, 0.155)"
        align="center"
      >
        <button
          class="sessionTypeButton"
          [ngClass]="{ selected: this.whatToDisplay == 'workshops' }"
          (click)="this.changeDisplay('workshops')"
        >
          Workshops
        </button>
      </div>
      <div
        class="col"
        style="padding: 0; border-left: 1px solid rgba(128, 128, 128, 0.155)"
        align="center"
      >
        <button
          class="sessionTypeButton"
          [ngClass]="{ selected: this.whatToDisplay == 'interviews' }"
          (click)="this.changeDisplay('interviews')"
        >
          Interviews
        </button>
      </div>
    </div>
  </div>
  <div class="container" *ngIf="this.whatToDisplay == 'form'">
    <div style="text-align: end; margin-top: 10px">
      <button
        *ngIf="!this.editingForm && this.currentUser.role == 'ProjectManagers'"
        type="button"
        class="btn btn-primary"
        (click)="this.editForm()"
      >
        Edit form
      </button>
    </div>
    <app-display-form
      *ngIf="!this.editingForm"
      [sessionId]="this.currentSession.id"
    ></app-display-form>
    <app-create-form
      *ngIf="this.editingForm"
      [formInfo]="this.currentForm"
      [parentSaveChanges]="this.updateFormInfo"
      (updateFormInfo)="this.updateFormInfo($event)"
    ></app-create-form>
  </div>
  <div class="table-responsive" *ngIf="this.whatToDisplay == 'candidates'">
    <table class="table">
      <thead>
        <tr>
          <td colspan="3" scope="col">Participants Information</td>
          <td scope="col">Status</td>
          <td scope="col">Take an action</td>
        </tr>
      </thead>
      <tbody>
        <tr
          class="participantInfo"
          *ngFor="let user of this.participants; index as userIndex"
        >
          <td (click)="goToUserProfile(userIndex)" style="width: 5%">
            {{ userIndex + 1 }}
          </td>
          <td (click)="goToUserProfile(userIndex)" style="width: 20%">
            {{ user.firstName }}
          </td>
          <td (click)="goToUserProfile(userIndex)" style="width: 20%">
            {{ user.lastName }}
          </td>
          <td
            *ngIf="this.getCurrentFormStatus() == 'Ended'"
            [ngClass]="{
              approvedStatus:
                this.participantsStatus[userIndex] == 'Passed form stage' ||
                this.participantsStatus[userIndex] ==
                  'Scheduled for workshop' ||
                this.participantsStatus[userIndex] == 'Passed workshop stage',
              rejectedStatus:
                this.participantsStatus[userIndex] ==
                  'Rejected at form stage' ||
                this.participantsStatus[userIndex] ==
                  'Rejected at workshop stage',
              waitingStatus:
                this.participantsStatus[userIndex] ==
                  'Waiting for form feedback' ||
                this.participantsStatus[userIndex] ==
                  'Not scheduled for workshop' ||
                this.participantsStatus[userIndex] ==
                  'Waiting for workshop feedback'
            }"
            (click)="goToUserProfile(userIndex)"
          >
            {{ this.participantsStatus[userIndex] }}
          </td>
          <td
            class="approvedStatus"
            *ngIf="this.getCurrentFormStatus() == 'Active'"
          >
            Waiting for form to close
          </td>
          <td class="participantActions">
            <button
              *ngIf="this.canGiveFormFeedback(userIndex)"
              class="actionButton approve"
              (click)="
                giveFormFeedback('pass', this.participants[userIndex].id)
              "
            >
              Pass
            </button>
            <button
              *ngIf="this.canGiveFormFeedback(userIndex)"
              class="actionButton reject"
              (click)="
                giveFormFeedback('reject', this.participants[userIndex].id)
              "
            >
              Reject
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="container" *ngIf="this.whatToDisplay == 'workshops'">
    <app-workshop-manager
      [session]="this.currentSession"
      [form]="this.currentForm"
    ></app-workshop-manager>
  </div>
</div>

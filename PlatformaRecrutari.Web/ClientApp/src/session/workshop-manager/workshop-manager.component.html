<div *ngIf="this.workshops && this.currentUser" class="container">
  <div class="row" style="margin-top: 10px">
    <div class="col">
      <h4>Workshops</h4>
    </div>
    <div class="col" align="right">
      <button
        *ngIf="this.currentUser.role == 'ProjectManager'"
        class="btn btn-outline-success"
        (click)="open(content)"
      >
        Create new workshop
      </button>
    </div>
  </div>

  <div *ngIf="this.workshops.length == 0" class="row">
    <div class="col">
      <h5>There are no workshops yet</h5>
    </div>
  </div>

  <div *ngIf="this.workshops.length != 0" class="table-responsive">
    <table class="table">
      <thead>
        <tr class="tableHeader">
          <td scope="col">#</td>
          <td scope="col">Departments</td>
          <td style="padding-right: 0" scope="col">Date</td>
          <td style="padding-left: 0" scope="col">Status</td>
          <td align="right" scope="col">Take an action</td>
        </tr>
      </thead>
      <tbody>
        <tr
          class="displayWorkshopInfo"
          *ngFor="let workshop of this.workshops; index as workshopIndex"
        >
          <td (click)="openWsInfo(workshopInfo, workshop)" style="width: 10px">
            {{ workshopIndex + 1 }}
          </td>
          <td (click)="openWsInfo(workshopInfo, workshop)">
            {{ this.parseDepartments(workshop) }}
          </td>
          <td (click)="openWsInfo(workshopInfo, workshop)">
            {{ this.parseDateForDisplay(workshop) }}
          </td>
          <td
            (click)="openWsInfo(workshopInfo, workshop)"
            [ngClass]="{
              active: this.parseWorkshopStatus(workshop) == 'Active now',
              finished: this.parseWorkshopStatus(workshop) == 'Finished',
              upcoming: this.parseWorkshopStatus(workshop) == 'Upcoming'
            }"
            style="padding-left: 0"
          >
            {{ this.parseWorkshopStatus(workshop) }}
          </td>
          <td class="userAction" align="right">
            <button
              type="button"
              style="margin-left: 10px"
              class="actionButton scheduleButton"
              (click)="this.openSchedule(schedule, workshop)"
              *ngIf="this.canSchedule()"
            >
              Schedule
            </button>
            <button
              type="button"
              (click)="editWorkshop(content, workshop)"
              class="actionButton editButton"
              *ngIf="
                this.parseWorkshopStatus(workshop) === 'Upcoming' &&
                this.currentUser.role == 'ProjectManager'
              "
            >
              Edit
            </button>
            <button
              type="button"
              style="margin-left: 10px"
              class="actionButton deleteButton"
              (click)="this.deleteWorkshop(workshop)"
              *ngIf="
                this.parseWorkshopStatus(workshop) === 'Upcoming' &&
                this.currentUser.role == 'ProjectManager'
              "
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #content let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Add workshop details</h4>
    </div>
    <div class="modal-body">
      <div class="container">
        <div class="row">
          <div class="col-3" style="padding-top: 10px; padding-right: 0">
            <label style="margin: 0; margin-right: 5px">Location: </label>
          </div>
          <div class="col" style="padding-left: 0">
            <textarea
              [(ngModel)]="this.newWorkshopLocation"
              class="locationTextarea"
              cols="50"
              rows="1"
              appTextareaAutoresize
            ></textarea>
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 10px; padding-right: 0">
            <span>Date&Time: </span>
          </div>
          <div class="col" style="padding-left: 0">
            <input
              [disabled]="true"
              class="dateTimeDisplay"
              [(ngModel)]="this.disaplyDateOfNewWorkshop"
            />
            <input
              matInput
              [matDatepicker]="picker"
              [(ngModel)]="this.newWorkshopDate"
              style="
                width: 0%;
                display: inline;
                border: 0;
                height: 0%;
                color: white;
              "
            />
            <mat-datepicker-toggle
              matSuffix
              style="color: black"
              [for]="picker"
            ></mat-datepicker-toggle>

            <input
              style="display: none"
              matTimepicker
              mode="24h"
              #t="matTimepicker"
              (timeChange)="this.updateHour($event)"
            />
            <mat-icon
              matSuffix
              *ngIf="this.newWorkshopDate"
              style="cursor: pointer; vertical-align: middle"
              (click)="t.showDialog()"
              >access_time</mat-icon
            >

            <mat-icon
              matSuffix
              *ngIf="!this.newWorkshopDate"
              style="vertical-align: middle; color: grey; cursor: default"
              >access_time</mat-icon
            >

            <mat-datepicker
              (closed)="this.updateDateDisplay()"
              #picker
            ></mat-datepicker>
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 10px; padding-right: 0">
            <span>Departments: </span>
          </div>
          <div
            class="col"
            style="padding-left: 0; padding-top: 10px"
            *ngFor="let option of this.departments"
          >
            <mat-checkbox
              color="primary"
              (change)="this.updateDepartments()"
              [(ngModel)]="this.departmentOptions[option]"
              >{{ option }}</mat-checkbox
            >
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 15px; padding-right: 0">
            <span>No. Participants: </span>
          </div>
          <div class="col" style="padding-left: 0; padding-top: 10px">
            <select
              [(ngModel)]="this.newWorkshopNoParticipants"
              class="form-control"
              style="width: 20%; height: 90%"
            >
              <option *ngFor="let num of this.noParticipantsList">
                {{ num }}
              </option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 15px; padding-right: 0">
            <span>No. Volunteers: </span>
          </div>
          <div class="col" style="padding-left: 0; padding-top: 10px">
            <select
              [(ngModel)]="this.newWorkshopNoVolunteers"
              class="form-control"
              style="width: 20%; height: 90%"
            >
              <option *ngFor="let num of [2, 3, 4, 5, 6]">
                {{ num }}
              </option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 15px; padding-right: 0">
            <span>No. Board Members: </span>
          </div>
          <div class="col" style="padding-left: 0; padding-top: 10px">
            <select
              [(ngModel)]="this.newWorkshopNoCD"
              class="form-control"
              style="width: 20%; height: 90%"
            >
              <option *ngFor="let num of [1, 2, 3, 4]">
                {{ num }}
              </option>
            </select>
          </div>
        </div>
        <div class="row">
          <span
            *ngFor="let error of this.newWorkshopFormErrors"
            style="display: block; width: 100%; color: red; margin-top: 5px"
            >{{ error }}</span
          >
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline-dark"
        (click)="saveNewWorkshop()"
      >
        Save
      </button>
    </div>
  </ng-template>

  <ng-template #schedule let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Workshop Scheduler</h4>
    </div>
    <div class="modal-body">
      <div class="container">
        <div class="row">
          <div class="col">
            <b>Date&Time:</b> {{ this.scheduleDate.toLocaleDateString() }},
            {{ this.scheduleDate.getHours().toString() }}:{{
              this.scheduleDate.getMinutes().toString()
            }}
          </div>
        </div>
        <div class="row">
          <div class="col"><b>Location:</b> {{ this.scheduleLocation }}</div>
        </div>
        <div class="row">
          <div class="col">
            <b>Departments:</b> {{ this.scheduleDepartments }}
          </div>
        </div>
        <div class="row">
          <div style="margin-top: 10px" class="col">
            <b>Select User: </b>
            <input
              type="text"
              class="form-control searchbar"
              placeholder="Participant Name"
              aria-label="Username"
              aria-describedby="addon-wrapping"
              (input)="updateFilteredList()"
              [(ngModel)]="this.searchedUserName"
            />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <select
              size="6"
              style="
                width: 100%;
                padding: 10px;
                border-radius: 5px;
                border-color: #dadee3;
                outline: none;
              "
              class="form-select"
              aria-label="size 6 select example"
              [(ngModel)]="this.selectedParticipant"
            >
              <option
                value="{{ user.id }}"
                (click)="this.updateSelected(user)"
                *ngFor="let user of this.filteredParticipantsToBeScheduled"
              >
                {{ user.firstName }} {{ user.lastName }}
              </option>
            </select>
          </div>
        </div>
        <div *ngIf="this.scheduleErrors.length != 0" class="row">
          <div class="col">
            <em style="color: red" *ngFor="let error of this.scheduleErrors">{{
              error
            }}</em>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline-dark"
        (click)="this.newParticipantSchedule()"
      >
        Schedule
      </button>
    </div>
  </ng-template>

  <ng-template #workshopInfo let-modal>
    <div class="modal-header">
      <div class="modal-title">
        <h4>Workshop Info</h4>
      </div>
    </div>
    <div class="modal-body">
      <div class="row">
        <div class="col">
          <b>Date&Time:</b> {{ this.wsInfoDate.toLocaleDateString() }},
          {{ this.wsInfoDate.getHours().toString() }}:{{
            this.wsInfoDate.getMinutes().toString()
          }}
        </div>
      </div>
      <div class="row">
        <div class="col"><b>Location:</b> {{ this.wsInfoLocation }}</div>
      </div>
      <div class="row">
        <div class="col"><b>Departments:</b> {{ this.wsInfoDepartments }}</div>
      </div>
      <div class="row">
        <div class="col">
          <b>Remaining slot for participants:</b>
          {{ this.wsInfoNoParticipants - this.wsInfoParticipants.length }}
        </div>
      </div>
      <div class="row changeWsInfoDisplayWrapper">
        <div
          class="col"
          align="center"
          style="padding: 0"
          (click)="this.changeWsInfoDisplay('participants')"
          [ngClass]="{ selected: this.wsInfoDisplay == 'participants' }"
        >
          <button class="changeWsInfoDisplay">Participants</button>
        </div>
        <div
          class="col"
          align="center"
          style="padding: 0"
          (click)="this.changeWsInfoDisplay('volunteers')"
          [ngClass]="{ selected: this.wsInfoDisplay == 'volunteers' }"
        >
          <button class="changeWsInfoDisplay">Volunteers</button>
        </div>
        <div
          class="col"
          align="center"
          style="padding: 0"
          (click)="this.changeWsInfoDisplay('cddd')"
          [ngClass]="{ selected: this.wsInfoDisplay == 'cddd' }"
        >
          <button class="changeWsInfoDisplay">Directors&Board</button>
        </div>
      </div>

      <div *ngIf="this.wsInfoDisplay == 'participants'" class="row">
        <div
          *ngIf="this.wsInfoParticipants.length != 0"
          class="col table-responsive"
        >
          <table class="table">
            <thead>
              <tr>
                <td scope="col"><b>#</b></td>
                <td scope="col"><b>Participant's Info</b></td>
                <td scope="col"><b>Status</b></td>
                <td scope="col"><b>Actions</b></td>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="
                  let participant of this.wsInfoParticipants;
                  index as participantIndex
                "
              >
                <td>{{ participantIndex + 1 }}.</td>
                <td>{{ participant.firstName }} {{ participant.lastName }}</td>
                <td
                  [ngClass]="{
                    green: getParticipantStatus(participantIndex) == 'Passed',
                    red: getParticipantStatus(participantIndex) == 'Rejected',
                    orange:
                      getParticipantStatus(participantIndex) ==
                        'Workshop not finished' ||
                      getParticipantStatus(participantIndex) ==
                        'Waiting for feedback'
                  }"
                >
                  {{ getParticipantStatus(participantIndex) }}
                </td>
                <td style="padding-left: 5px">
                  <button
                    *ngIf="canRemoveParticipantFromWS(participantIndex)"
                    (click)="
                      deleteScheduledParticipant(
                        participant.id,
                        this.wsInfoOpened.id
                      )
                    "
                    class="removeParticipant"
                  >
                    Remove from worshop
                  </button>
                  <button
                    (click)="
                      giveFeedbackModal(
                        participant,
                        this.wsInfoOpened,
                        participantWSFeedback
                      )
                    "
                    *ngIf="canGiveFeedback(participantIndex)"
                    class="giveFeedback"
                  >
                    Give feedback
                  </button>
                  <button
                    (click)="
                      viewFeedbackModal(
                        participant,
                        this.wsInfoOpened,
                        participantIndex,
                        participantWSFeedbackView
                      )
                    "
                    *ngIf="canViewFeedback(participantIndex)"
                    class="editFeedback"
                  >
                    View feedback
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="this.wsInfoParticipants.length == 0" class="col">
          <h4>There are no scheduled participants yet!</h4>
        </div>
      </div>
      <div *ngIf="this.wsInfoDisplay == 'volunteers'" class="row">
        <div class="col" *ngIf="this.wsInfoVolunteers.length == 0">
          <h4>There are no scheduled volunteers yet!</h4>
        </div>
        <div
          class="col table-responsive"
          *ngIf="this.wsInfoVolunteers.length != 0"
        >
          <table class="table">
            <thead>
              <tr>
                <td><b>#</b></td>
                <td><b>Volunteer info</b></td>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="
                  let volunteer of this.wsInfoVolunteers;
                  index as volIndex
                "
              >
                <td style="width: 5px">{{ volIndex + 1 }}.</td>
                <td>{{ volunteer.firstName }} {{ volunteer.lastName }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div *ngIf="this.wsInfoDisplay == 'cddd'" class="row">
        <div class="col" *ngIf="this.wsInfoCddd.length == 0">
          <h4>There are no scheduled directors or board members yet!</h4>
        </div>
        <div class="col" *ngIf="this.wsInfoCddd.length != 0">
          <table class="table">
            <thead>
              <tr>
                <td><b>#</b></td>
                <td><b>Member info</b></td>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let cddd of this.wsInfoCddd; index as cdddIndex">
                <td style="width: 5px">{{ cdddIndex + 1 }}.</td>
                <td>
                  {{ cddd.firstName }} {{ cddd.lastName }} | {{ cddd.role }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        class="btn btn-outline-primary"
        (click)="this.assignMyself()"
        *ngIf="canParticipateAsVolunteerOrCDDD() === 'canApply'"
      >
        Schedule myself for this workshop
      </button>
      <button
        class="btn btn-outline-danger"
        (click)="removeMyselfFromWs()"
        *ngIf="canParticipateAsVolunteerOrCDDD() === 'canRemove'"
      >
        Remove myself from this workshop
      </button>
    </div>
  </ng-template>

  <ng-template #participantWSFeedback let-modal>
    <div class="modal-header">
      <div class="modal-title">
        <h4 *ngIf="!this.editFeedbackStatus">Feedback</h4>
        <h4 *ngIf="this.editFeedbackStatus">Edit feedback</h4>
        <span
          >Access user profile
          <a href="/user/{{ this.feedbackParticipant.id }}" target="_blank"
            >here</a
          ></span
        >
      </div>
    </div>
    <div class="modal-body">
      <div class="container">
        <div class="row">
          <div class="col">
            <b>Candidate:</b> {{ this.feedbackParticipant.firstName }}
            {{ this.feedbackParticipant.lastName }}
          </div>
        </div>
        <div class="row">
          <div class="col">
            <b>Facebook: </b>
            <a href="{{ this.feedbackParticipant.facebook }}">{{
              this.feedbackParticipant.facebook
            }}</a>
          </div>
        </div>
        <div *ngIf="this.editFeedbackStatus" class="row">
          <div class="col">
            <b>Status:</b>
            <span
              [ngClass]="{
                green: this.editFeedbackStatus == 'Passed',
                red: this.editFeedbackStatus == 'Rejected'
              }"
              >{{ this.editFeedbackStatus }}</span
            >
          </div>
        </div>
        <div class="row">
          <div style="margin-right: 15px; padding-top: 2px" class="col-1">
            <span> <b>Feedback:</b></span>
          </div>
          <div class="col">
            <textarea
              rows="1"
              cols="50"
              style="padding-left: 0"
              class="feedbackTextarea"
              [(ngModel)]="this.userFeedback"
              appTextareaAutoresize
            ></textarea>
          </div>
        </div>
        <div class="row">
          <div class="col-2" style="padding-top: 15px; padding-right: 0">
            <span>Yes votes: </span>
          </div>
          <div class="col" style="padding-left: 0; padding-top: 10px">
            <select
              [(ngModel)]="this.givenYesVotes"
              class="form-control"
              style="width: 20%; height: 90%"
            >
              <option
                *ngFor="let num of this.maximumNumberOfVotes"
                value="{{ num }}"
              >
                {{ num }}
              </option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col-2" style="padding-top: 15px; padding-right: 0">
            <span>No votes: </span>
          </div>
          <div class="col" style="padding-left: 0; padding-top: 10px">
            <select
              [(ngModel)]="this.givenNoVotes"
              class="form-control"
              style="width: 20%; height: 90%"
            >
              <option
                *ngFor="let num of this.maximumNumberOfVotes"
                value="{{ num }}"
              >
                {{ num }}
              </option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col-2" style="padding-top: 15px; padding-right: 0">
            <span>Abstention: </span>
          </div>
          <div class="col" style="padding-left: 0; padding-top: 10px">
            <select
              [(ngModel)]="this.abstainedVotes"
              class="form-control"
              style="width: 20%; height: 90%"
            >
              <option
                *ngFor="let num of this.maximumNumberOfVotes"
                value="{{ num }}"
              >
                {{ num }}
              </option>
            </select>
          </div>
        </div>
        <div *ngIf="this.feedbackErrors.length != 0" class="row">
          <em
            style="color: red; width: 100%"
            *ngFor="let err of this.feedbackErrors"
            >{{ err }}</em
          >
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        *ngIf="!this.editFeedbackStatus"
        (click)="this.giveFeedback(modal, false)"
        class="btn btn-outline-primary"
      >
        Cast vote
      </button>
      <button
        *ngIf="this.editFeedbackStatus"
        class="btn btn-outline-danger"
        (click)="this.deleteFeedback(this.editFeedbackPariticpantIndex, modal)"
      >
        Delete feedback
      </button>
      <button
        *ngIf="this.editFeedbackStatus"
        (click)="this.giveFeedback(modal, true)"
        class="btn btn-outline-primary"
      >
        Save edits
      </button>
    </div>
  </ng-template>

  <ng-template #participantWSFeedbackView let-modal>
    <div class="modal-header">
      <div class="modal-title"><h4>Workshop feedback info</h4></div>
    </div>
    <div class="modal-body">
      <div class="container">
        <div class="container">
          <div class="row">
            <div class="col">
              <b>Candidate:</b> {{ this.feedbackParticipant.firstName }}
              {{ this.feedbackParticipant.lastName }}
            </div>
          </div>
          <div class="row">
            <div class="col">
              <b>Facebook: </b>
              <a href="{{ this.feedbackParticipant.facebook }}">{{
                this.feedbackParticipant.facebook
              }}</a>
            </div>
          </div>
          <div *ngIf="this.editFeedbackStatus" class="row">
            <div class="col">
              <b>Status: </b>
              <span
                [ngClass]="{
                  green: this.editFeedbackStatus == 'Passed',
                  red: this.editFeedbackStatus == 'Rejected'
                }"
                >{{ this.editFeedbackStatus }}</span
              >
            </div>
          </div>
          <br />
          <div class="row" style="margin-bottom: 15px">
            <div class="col-12"><b>Feedback:</b></div>
            <div
              class="col-12"
              style="
                word-break: break-all;
                overflow: hidden;
                white-space: pre-wrap;
              "
            >
              <span>{{ this.viewedWorkshopFeedback.feedback }}</span>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <b>Yes votes: </b>{{ this.viewedWorkshopFeedback.yesVotes }}
            </div>
          </div>
          <div class="row">
            <div class="col">
              <b>No votes: </b>{{ this.viewedWorkshopFeedback.noVotes }}
            </div>
          </div>
          <div class="row">
            <div class="col">
              <b>Abstains: </b>{{ this.viewedWorkshopFeedback.abstainVotes }}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer"></div>
  </ng-template>
</div>

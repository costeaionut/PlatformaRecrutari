<div *ngIf="this.workshops && this.currentUser" class="container">
  <div class="row" style="margin-top: 10px">
    <div class="col">
      <h4>Workshops</h4>
    </div>
    <div class="col" align="right">
      <button class="btn btn-outline-success" (click)="open(content)">
        Create new workshop
      </button>
    </div>
  </div>

  <div *ngIf="this.workshops.length == 0" class="row">
    <div class="col">
      <h5>There are no workshops yet</h5>
    </div>
  </div>

  <div *ngIf="this.workshops.length != 0" class="table-responsive">
    <table class="table">
      <thead>
        <tr class="tableHeader">
          <td scope="col">#</td>
          <td scope="col">Departments</td>
          <td style="padding-right: 0" scope="col">Date</td>
          <td style="padding-left: 0" scope="col">Status</td>
          <td align="right" scope="col">Take an action</td>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let workshop of this.workshops; index as workshopIndex">
          <td style="width: 10px">{{ workshopIndex + 1 }}</td>
          <td>{{ this.parseDepartments(workshop) }}</td>
          <td>{{ this.parseDateForDisplay(workshop) }}</td>
          <td
            [ngClass]="{
              active: this.parseWorkshopStatus(workshop) == 'Active now',
              finished: this.parseWorkshopStatus(workshop) == 'Finished',
              upcoming: this.parseWorkshopStatus(workshop) == 'Upcoming'
            }"
            style="padding-left: 0"
          >
            {{ this.parseWorkshopStatus(workshop) }}
          </td>
          <td align="right">
            <button
              type="button"
              style="margin-left: 10px"
              class="actionButton scheduleButton"
              (click)="this.openSchedule(schedule, workshop)"
              *ngIf="this.currentUser.role != 'Participant'"
            >
              Schedule
            </button>
            <button
              type="button"
              (click)="editWorkshop(content, workshop)"
              class="actionButton editButton"
              *ngIf="
                this.parseWorkshopStatus(workshop) === 'Upcoming' &&
                this.currentUser.role == 'ProjectManager'
              "
            >
              Edit
            </button>
            <button
              type="button"
              style="margin-left: 10px"
              class="actionButton deleteButton"
              (click)="this.deleteWorkshop(workshop)"
              *ngIf="
                this.parseWorkshopStatus(workshop) === 'Upcoming' &&
                this.currentUser.role == 'ProjectManager'
              "
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #content let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Add workshop details</h4>
    </div>
    <div class="modal-body">
      <div class="container">
        <div class="row">
          <div class="col-3" style="padding-top: 10px; padding-right: 0">
            <label style="margin: 0; margin-right: 5px">Location: </label>
          </div>
          <div class="col" style="padding-left: 0">
            <textarea
              [(ngModel)]="this.newWorkshopLocation"
              class="locationTextarea"
              cols="50"
              rows="1"
              appTextareaAutoresize
            ></textarea>
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 10px; padding-right: 0">
            <span>Date&Time: </span>
          </div>
          <div class="col" style="padding-left: 0">
            <input
              [disabled]="true"
              class="dateTimeDisplay"
              [(ngModel)]="this.disaplyDateOfNewWorkshop"
            />
            <input
              matInput
              [matDatepicker]="picker"
              [(ngModel)]="this.newWorkshopDate"
              style="
                width: 0%;
                display: inline;
                border: 0;
                height: 0%;
                color: white;
              "
            />
            <mat-datepicker-toggle
              matSuffix
              style="color: black"
              [for]="picker"
            ></mat-datepicker-toggle>

            <input
              style="display: none"
              matTimepicker
              mode="24h"
              #t="matTimepicker"
              (timeChange)="this.updateHour($event)"
            />
            <mat-icon
              matSuffix
              *ngIf="this.newWorkshopDate"
              style="cursor: pointer; vertical-align: middle"
              (click)="t.showDialog()"
              >access_time</mat-icon
            >

            <mat-icon
              matSuffix
              *ngIf="!this.newWorkshopDate"
              style="vertical-align: middle; color: grey; cursor: default"
              >access_time</mat-icon
            >

            <mat-datepicker
              (closed)="this.updateDateDisplay()"
              #picker
            ></mat-datepicker>
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 10px; padding-right: 0">
            <span>Departments: </span>
          </div>
          <div
            class="col"
            style="padding-left: 0; padding-top: 10px"
            *ngFor="let option of this.departments"
          >
            <mat-checkbox
              color="primary"
              (change)="this.updateDepartments()"
              [(ngModel)]="this.departmentOptions[option]"
              >{{ option }}</mat-checkbox
            >
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 15px; padding-right: 0">
            <span>No. Participants: </span>
          </div>
          <div class="col" style="padding-left: 0; padding-top: 10px">
            <select
              [(ngModel)]="this.newWorkshopNoParticipants"
              class="form-control"
              style="width: 20%; height: 90%"
            >
              <option *ngFor="let num of this.noParticipantsList">
                {{ num }}
              </option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 15px; padding-right: 0">
            <span>No. Volunteers: </span>
          </div>
          <div class="col" style="padding-left: 0; padding-top: 10px">
            <select
              [(ngModel)]="this.newWorkshopNoVolunteers"
              class="form-control"
              style="width: 20%; height: 90%"
            >
              <option *ngFor="let num of [2, 3, 4, 5, 6]">
                {{ num }}
              </option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top: 5px">
          <div class="col-3" style="padding-top: 15px; padding-right: 0">
            <span>No. Board Members: </span>
          </div>
          <div class="col" style="padding-left: 0; padding-top: 10px">
            <select
              [(ngModel)]="this.newWorkshopNoCD"
              class="form-control"
              style="width: 20%; height: 90%"
            >
              <option *ngFor="let num of [1, 2, 3, 4]">
                {{ num }}
              </option>
            </select>
          </div>
        </div>
        <div class="row">
          <span
            *ngFor="let error of this.newWorkshopFormErrors"
            style="display: block; width: 100%; color: red; margin-top: 5px"
            >{{ error }}</span
          >
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline-dark"
        (click)="saveNewWorkshop()"
      >
        Save
      </button>
    </div>
  </ng-template>

  <ng-template #schedule let-modal>
    <div class="modal-header">
      <h4 class="modal-title">Workshop Scheduler</h4>
    </div>
    <div class="modal-body">
      <div class="container">
        <div class="row">
          <div class="col">
            <b>Date&Time:</b> {{ this.scheduleDate.toLocaleDateString() }},
            {{ this.scheduleDate.getHours().toString() }}:{{
              this.scheduleDate.getMinutes().toString()
            }}
          </div>
        </div>
        <div class="row">
          <div class="col"><b>Location:</b> {{ this.scheduleLocation }}</div>
        </div>
        <div class="row">
          <div class="col">
            <b>Departments:</b> {{ this.scheduleDepartments }}
          </div>
        </div>
        <div class="row">
          <div style="margin-top: 10px" class="col">
            <b>Select User: </b>
            <input
              type="text"
              class="form-control searchbar"
              placeholder="Participant Name"
              aria-label="Username"
              aria-describedby="addon-wrapping"
              (input)="updateFilteredList()"
              [(ngModel)]="this.searchedUserName"
            />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <select
              size="6"
              style="
                width: 100%;
                padding: 10px;
                border-radius: 5px;
                border-color: #dadee3;
                outline: none;
              "
              class="form-select"
              aria-label="size 6 select example"
              [(ngModel)]="this.selectedParticipant"
            >
              <option
                value="{{ user.id }}"
                (click)="this.updateSelected(user)"
                *ngFor="let user of this.filteredParticipantsToBeScheduled"
              >
                {{ user.firstName }} {{ user.lastName }}
              </option>
            </select>
          </div>
        </div>
        <div *ngIf="this.scheduleErrors.length != 0" class="row">
          <div class="col">
            <em style="color: red" *ngFor="let error of this.scheduleErrors">{{
              error
            }}</em>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline-dark"
        (click)="this.newSchedule()"
      >
        Schedule
      </button>
    </div>
  </ng-template>
</div>
